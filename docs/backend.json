
{
  "entities": {
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered by CyberLearn.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the course."
        },
        "title": {
          "type": "string",
          "description": "The title of the course."
        },
        "description": {
          "type": "string",
          "description": "A description of the course content and objectives."
        },
        "price": {
          "type": "number",
          "description": "The price of the course."
        },
        "instructorId": {
          "type": "string",
          "description": "Reference to the Instructor who teaches the course. (Relationship: Instructor 1:N Course)"
        },
        "learningObjectives": {
          "type": "array",
          "description": "A list of learning objectives for the course.",
          "items": {
            "type": "string"
          }
        },
        "curriculum": {
          "type": "array",
          "description": "A list of curriculum topics covered in this course.",
          "items": {
            "type": "string"
          }
        },
        "level": {
          "type": "string",
          "description": "The difficulty level of the course.",
          "enum": ["Beginner", "Intermediate", "Advanced", "Highly Advanced"]
        },
        "category": {
          "type": "string",
          "description": "The category the course belongs to."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "price",
        "instructorId",
        "level",
        "category"
      ]
    },
    "Instructor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Instructor",
      "type": "object",
      "description": "Represents an instructor's profile and account at CyberLearn.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the instructor (matches Firebase Auth UID)."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the instructor."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the instructor."
        },
        "motherName": {
          "type": "string"
        },
        "fatherName": {
          "type": "string"
        },
        "age": {
          "type": "number"
        },
        "email": {
          "type": "string",
          "description": "The primary email address (Gmail) of the instructor.",
          "format": "email"
        },
        "alternateEmail": {
          "type": "string",
          "format": "email"
        },
        "mobileNumber": {
          "type": "string"
        },
        "alternateMobileNumber": {
          "type": "string"
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates if the instructor's profile has been verified by an admin."
        },
        "accountStatus": {
          "type": "string",
          "description": "The current status of the instructor's account.",
          "enum": [
            "pending",
            "active",
            "rejected",
            "banned"
          ]
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the instructor for public display."
        },
        "title": {
          "type": "string",
          "description": "The instructor's professional title (e.g., 'Senior Penetration Tester')."
        },
        "teachingCategory": {
          "type": "string",
          "description": "The primary category the instructor teaches in.",
          "enum": ["hacking", "datascience", "webdev", "aiml", "programming", "others"]
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "isVerified",
        "accountStatus"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student's profile at CyberLearn.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the student (matches Firebase Auth UID)."
        },
        "name": {
          "type": "string",
          "description": "The full name of the student."
        },
        "email": {
          "type": "string",
          "description": "The primary email address of the student.",
          "format": "email"
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "username": {
          "type": "string",
          "description": "The student's chosen username (e.g., user.name@123)."
        },
        "onboardingStatus": {
          "type": "string",
          "description": "Tracks the user's progress through the initial setup flow.",
          "enum": [
            "new",
            "profile_complete",
            "username_complete",
            "active"
          ]
        },
        "mobileNumber": {
          "type": "string"
        },
        "alternateMobileNumber": {
          "type": "string"
        },
        "motherName": {
          "type": "string"
        },
        "fatherName": {
          "type": "string"
        },
        "alternateEmail": {
          "type": "string",
          "format": "email"
        },
        "enrolledCourseIds": {
          "type": "array",
          "description": "References to Courses the student is enrolled in. (Relationship: Student N:N Course)",
          "items": {
            "type": "string"
          }
        },
        "publicChatStats": {
          "type": "object",
          "description": "Tracks usage of the public chat.",
          "properties": {
            "messageCount": {
              "type": "number",
              "description": "Number of messages sent in the current week."
            },
            "weekStartTimestamp": {
              "type": "string",
              "format": "date-time",
              "description": "The timestamp when the current message counting week started."
            }
          }
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "onboardingStatus"
      ]
    },
    "Enrollment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Enrollment",
      "type": "object",
      "description": "Represents a student's enrollment in a course and their purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the enrollment record."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student who is enrolled. (Relationship: Student 1:N Enrollment)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to the Course the student is enrolled in. (Relationship: Course 1:N Enrollment)"
        },
        "enrollmentDate": {
          "type": "string",
          "description": "The date the student enrolled in the course.",
          "format": "date-time"
        },
        "purchaseDate": {
          "type": "string",
          "description": "The date the course was purchased",
          "format": "date-time"
        },
        "price": {
          "type": "number",
          "description": "Price paid for enrollment."
        },
        "razorpayPaymentId": {
            "type": "string"
        },
        "razorpayOrderId": {
            "type": "string"
        },
        "razorpaySignature": {
            "type": "string"
        }
      },
      "required": [
        "id",
        "studentId",
        "courseId",
        "enrollmentDate",
        "purchaseDate",
        "price"
      ]
    },
    "Wallet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Wallet",
      "type": "object",
      "description": "Stores an instructor's earnings and withdrawal information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the wallet (matches instructor's UID)."
        },
        "currentBalance": {
          "type": "number"
        },
        "totalEarned": {
          "type": "number"
        },
        "pendingWithdrawal": {
          "type": "number"
        }
      },
      "required": [
        "id",
        "currentBalance",
        "totalEarned",
        "pendingWithdrawal"
      ]
    },
    "PayoutRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayoutRequest",
      "type": "object",
      "description": "Represents an instructor's request to withdraw funds.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payout request."
        },
        "instructorId": {
          "type": "string"
        },
        "amount": {
          "type": "number"
        },
        "requestDate": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "paid",
            "rejected"
          ]
        },
        "paidDate": {
          "type": "string",
          "format": "date-time"
        },
        "rejectionReason": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "instructorId",
        "amount",
        "requestDate",
        "status"
      ]
    },
    "ContactSubmission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContactSubmission",
      "type": "object",
      "description": "Represents a submission from the public contact form.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the submission."
        },
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "mobileNumber": {
          "type": "string"
        },
        "companySize": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "scheduleDemo": {
          "type": "boolean"
        },
        "submittedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "mobileNumber",
        "message",
        "submittedAt"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat Message",
      "type": "object",
      "description": "Represents a single message in a public or private chat.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "userId": {
          "type": "string",
          "description": "The UID of the user who sent the message."
        },
        "userName": {
          "type": "string",
          "description": "The display name of the user who sent the message."
        },
        "userAvatar": {
          "type": "string",
          "description": "URL of the sender's profile picture.",
          "format": "uri"
        },
        "timestamp": {
          "type": "string",
          "description": "The server timestamp when the message was created.",
          "format": "date-time"
        },
        "isInstructor": {
            "type": "boolean",
            "description": "Indicates if the message was sent by a verified instructor."
        },
        "isRead": {
            "type": "boolean",
            "description": "Indicates if the message has been read by the recipient (in private chat)."
        }
      },
      "required": [
        "text",
        "userId",
        "userName",
        "timestamp"
      ]
    },
    "Video": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Video",
      "type": "object",
      "description": "Represents a video uploaded to Hostinger.",
      "properties": {
        "id": {
          "type": "string"
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "fileName": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "category": {
          "type": "string",
          "description": "The course category this video belongs to."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "uploaderId": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "url",
        "fileName",
        "title",
        "category",
        "createdAt",
        "uploaderId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores details about each course. Publicly readable, writeable only by Instructors or Admins.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/instructors/{instructorId}",
        "definition": {
          "entityName": "Instructor",
          "schema": {
            "$ref": "#/backend/entities/Instructor"
          },
          "description": "Stores instructor profile information. Readable by the instructor and admins, but only writeable by admins after creation.",
          "params": [
            {
              "name": "instructorId",
              "description": "Unique identifier for the instructor."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student profile information. Only accessible by the user themselves or admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the student (User ID from authentication)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/enrollments/{enrollmentId}",
        "definition": {
          "entityName": "Enrollment",
          "schema": {
            "$ref": "#/backend/entities/Enrollment"
          },
          "description": "Stores enrollment records for each student. Only accessible by the user themselves or admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the student (User ID from authentication)."
            },
            {
              "name": "enrollmentId",
              "description": "Unique identifier for the enrollment record."
            }
          ]
        }
      },
      {
        "path": "/wallets/{walletId}",
        "definition": {
          "entityName": "Wallet",
          "schema": {
            "$ref": "#/backend/entities/Wallet"
          },
          "description": "Stores an instructor's earnings. Read-only for the instructor, and completely client-unwritable.",
          "params": [
            {
              "name": "walletId",
              "description": "The instructor's UID."
            }
          ]
        }
      },
      {
        "path": "/payout_requests/{requestId}",
        "definition": {
          "entityName": "PayoutRequest",
          "schema": {
            "$ref": "#/backend/entities/PayoutRequest"
          },
          "description": "Stores instructor payout requests. Writable by instructors, manageable by admins.",
          "params": [
            {
              "name": "requestId",
              "description": "Unique ID for the payout request."
            }
          ]
        }
      },
      {
        "path": "/contact_submissions/{submissionId}",
        "definition": {
          "entityName": "ContactSubmission",
          "schema": {
            "$ref": "#/backend/entities/ContactSubmission"
          },
          "description": "Stores submissions from the public contact form. Publicly writable, admin-readable.",
          "params": [
            {
              "name": "submissionId",
              "description": "Unique ID for the submission."
            }
          ]
        }
      },
      {
        "path": "/public_chat/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all messages for the public world chat. Readable and writable by any authenticated user.",
          "params": [
            {
              "name": "messageId",
              "description": "Unique ID for the chat message."
            }
          ]
        }
      },
      {
        "path": "/private_chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores messages for private one-on-one chats between users. Read/write access is restricted to chat participants.",
          "params": [
            {
              "name": "chatId",
              "description": "A unique identifier for the chat, typically a combination of the two user IDs."
            },
            {
              "name": "messageId",
              "description": "Unique ID for the chat message."
            }
          ]
        }
      },
      {
        "path": "/course_videos/{videoId}",
        "definition": {
          "entityName": "Video",
          "schema": {
            "$ref": "#/backend/entities/Video"
          },
          "description": "Stores metadata about videos uploaded to Hostinger, organized by course category.",
          "params": [
            {
              "name": "videoId",
              "description": "Unique ID for the video."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure and scalable data model for the CyberLearn application, focusing on authorization independence and clear data relationships. The structure emphasizes path-based ownership for private user data and membership maps for collaborative data access. \n\nAuthorization Independence (CRITICAL):  Authorization Independence is achieved by avoiding the get() function in rules. This is accomplished via denormalization: relevant authorization data (such as course instructor) is included directly within the documents where it's needed.\n\nQAPs Support: List operations are secured through structural segregation and path-based ownership. User-specific data (enrollments) is stored under the `/users/{userId}` path, allowing secure listing of only the current user's enrollments. Access to the courses collection is controlled by role-based access via the instructorId field, and is publicly readable only."
  }
}

    